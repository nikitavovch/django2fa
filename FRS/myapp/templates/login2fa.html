<html>
<head>
    <title>WebAuthn Test</title>
</head>
<body>
    <button id="register-button">Register Passkey</button>
    <div id="status-message"></div>

    <script>
        document.getElementById('register-button').addEventListener('click', () => {
            fetch('/webauthn/register-options/')
                .then(response => response.json())
                .then(options => navigator.credentials.create(options))
                .then(credential => {
                    return fetch('/webauthn/register/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify(credential)
                    });
                })
                .then(response => response.json())
                .then(result => {
                    document.getElementById('status-message').textContent = result.success ? 'Registration successful!' : 'Registration failed: ' + result.error;
                })
                .catch(error => {
                    document.getElementById('status-message').textContent = 'Registration error: ' + error.message;
                });
        });
    </script>
</body>
</html>